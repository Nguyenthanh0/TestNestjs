<!-- <!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Th√¥ng b√°o comment m·ªõi - WebSocket</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        background: #f6f8fa;
        color: #222;
        padding: 20px;
      }
      h1 {
        color: #1f6feb;
      }
      #status {
        padding: 10px;
        border-radius: 5px;
        background: #e0eaff;
        display: inline-block;
        margin-bottom: 15px;
      }
      #log {
        background: #fff;
        padding: 15px;
        border-radius: 10px;
        max-width: 600px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
      }
      .message {
        background: #dfffdc;
        border-left: 5px solid #28a745;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
      }
      .error {
        background: #ffeaea;
        border-left: 5px solid #dc3545;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
      }
      input {
        width: 400px;
        padding: 8px;
        margin-top: 10px;
      }
      button {
        padding: 8px 12px;
        margin-left: 5px;
        background-color: #1f6feb;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #145cc7;
      }
    </style>
  </head>
  <body>
    <h1>üîî Th√¥ng b√°o khi c√≥ comment m·ªõi</h1>
    <p>Nh·∫≠p access token c·ªßa <strong>user s·ªü h·ªØu post</strong>:</p>
    <input type="text" id="token" placeholder="D√°n accessToken v√†o ƒë√¢y..." />
    <button id="connectBtn">K·∫øt n·ªëi WebSocket</button>
    <div id="status">Ch∆∞a k·∫øt n·ªëi</div>

    <h3>Model hi·ªÉn th·ªã th√¥ng b√°o</h3>
    <div id="log"></div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      let socket;

      document.getElementById('connectBtn').addEventListener('click', () => {
        const token = document.getElementById('token').value.trim();
        const logDiv = document.getElementById('log');
        const statusDiv = document.getElementById('status');

        if (!token) {
          alert('‚ö†Ô∏è B·∫°n c·∫ßn nh·∫≠p access token tr∆∞·ªõc khi k·∫øt n·ªëi!');
          return;
        }

        // Ng·∫Øt k·∫øt n·ªëi c≈© n·∫øu c√≥
        if (socket && socket.connected) {
          socket.disconnect();
        }

        logDiv.innerHTML = '';
        statusDiv.textContent = '‚è≥ ƒêang k·∫øt n·ªëi...';

        // ‚úÖ G·ª≠i token qua thu·ªôc t√≠nh auth (ƒë√∫ng v·ªõi PostGateway)
        socket = io('http://localhost:3000', {
          auth: {
            token: `Bearer ${token}`,
          },
          transports: ['websocket'],
        });

        // Khi k·∫øt n·ªëi th√†nh c√¥ng
        socket.on('connect', () => {
          statusDiv.textContent = 'ƒê√£ k·∫øt n·ªëi WebSocket!';
          statusDiv.style.background = '#d1ffd6';
          logDiv.innerHTML += `<div class="message">K·∫øt n·ªëi th√†nh c√¥ng ƒë·∫øn server.</div>`;
          console.log('‚úÖ WebSocket connected!');
        });

        // Khi b·ªã ng·∫Øt k·∫øt n·ªëi
        socket.on('disconnect', () => {
          statusDiv.textContent = '‚ùå M·∫•t k·∫øt n·ªëi WebSocket!';
          statusDiv.style.background = '#ffeaea';
          logDiv.innerHTML += `<div class="error">M·∫•t k·∫øt n·ªëi v·ªõi server.</div>`;
        });

        // Khi nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o newComment t·ª´ PostGateway
        socket.on('newComment', (data) => {
          console.log('üì© Nh·∫≠n th√¥ng b√°o:', data);
          const msg = `
        <div class="message">
          <strong>${data.message}</strong><br/>
          <pre>${JSON.stringify(data.comment, null, 2)}</pre>
        </div>
      `;
          logDiv.innerHTML += msg;
        });

        // Khi c√≥ l·ªói k·∫øt n·ªëi
        socket.on('connect_error', (err) => {
          statusDiv.textContent = '‚ö†Ô∏è L·ªói k·∫øt n·ªëi!';
          statusDiv.style.background = '#ffeaea';
          logDiv.innerHTML += `<div class="error">L·ªói: ${err.message}</div>`;
          console.error('Connection error:', err);
        });
      });
    </script>
  </body>
</html> -->
<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Th√¥ng b√°o comment m·ªõi - WebSocket</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        background: #f6f8fa;
        color: #222;
        padding: 20px;
      }
      h1 {
        color: #1f6feb;
      }
      #status {
        padding: 10px;
        border-radius: 5px;
        background: #e0eaff;
        display: inline-block;
        margin-bottom: 15px;
      }
      #log {
        background: #fff;
        padding: 15px;
        border-radius: 10px;
        max-width: 600px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
      }
      .message {
        background: #dfffdc;
        border-left: 5px solid #28a745;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
      }
      .error {
        background: #ffeaea;
        border-left: 5px solid #dc3545;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
      }
      input {
        width: 400px;
        padding: 8px;
        margin-top: 10px;
      }
      button {
        padding: 8px 12px;
        margin-left: 5px;
        background-color: #1f6feb;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #145cc7;
      }
      hr {
        margin: 25px 0;
        border: none;
        border-top: 1px solid #ccc;
      }
    </style>
  </head>
  <body>
    <h1>üîî Th√¥ng b√°o khi c√≥ comment m·ªõi</h1>

    <p>Nh·∫≠p access token c·ªßa <strong>user s·ªü h·ªØu post</strong>:</p>
    <input type="text" id="token" placeholder="D√°n accessToken v√†o ƒë√¢y..." />
    <button id="connectBtn">K·∫øt n·ªëi WebSocket</button>
    <div id="status">Ch∆∞a k·∫øt n·ªëi</div>

    <hr />

    <h2>G·ª≠i message l√™n server</h2>
    <input
      type="text"
      id="messageInput"
      placeholder="Nh·∫≠p n·ªôi dung message..."
    />
    <button id="sendBtn">G·ª≠i message</button>

    <h3>Model hi·ªÉn th·ªã th√¥ng b√°o</h3>
    <div id="log"></div>

    <script>
      let socket;

      document.getElementById('connectBtn').addEventListener('click', () => {
        const token = document.getElementById('token').value.trim();
        const logDiv = document.getElementById('log');
        const statusDiv = document.getElementById('status');

        if (!token) {
          alert('‚ö†Ô∏è B·∫°n c·∫ßn nh·∫≠p access token tr∆∞·ªõc khi k·∫øt n·ªëi!');
          return;
        }

        if (socket && socket.connected) {
          socket.disconnect();
        }

        logDiv.innerHTML = '';
        statusDiv.textContent = '‚è≥ ƒêang k·∫øt n·ªëi...';

        socket = io('http://localhost:3000', {
          auth: {
            token: `Bearer ${token}`,
          },
          transports: ['websocket'],
        });

        socket.on('connect', () => {
          statusDiv.textContent = '‚úÖ ƒê√£ k·∫øt n·ªëi WebSocket!';
          statusDiv.style.background = '#d1ffd6';
          logDiv.innerHTML += `<div class="message">K·∫øt n·ªëi th√†nh c√¥ng ƒë·∫øn server.</div>`;
        });

        socket.on('disconnect', () => {
          statusDiv.textContent = '‚ùå M·∫•t k·∫øt n·ªëi WebSocket!';
          statusDiv.style.background = '#ffeaea';
          logDiv.innerHTML += `<div class="error">M·∫•t k·∫øt n·ªëi v·ªõi server.</div>`;
        });

        // üì© Khi c√≥ comment m·ªõi
        socket.on('newComment', (data) => {
          console.log('üí¨ Nh·∫≠n th√¥ng b√°o comment:', data);
          const msg = `
        <div class="message">
          <strong>${data.message}</strong><br/>
          <pre>${JSON.stringify(data.comment, null, 2)}</pre>
        </div>
      `;
          logDiv.innerHTML += msg;
        });

        // üëç Khi c√≥ like m·ªõi
        socket.on('newLike', (data) => {
          console.log('üëç Nh·∫≠n th√¥ng b√°o like:', data);
          const msg = `
        <div class="message">
          <strong>${data.message}</strong><br/>
          <pre>${JSON.stringify(data.content, null, 2)}</pre>
        </div>
      `;
          logDiv.innerHTML += msg;
        });

        socket.on('Server Response', (data) => {
          logDiv.innerHTML += `<div class="message">Ph·∫£n h·ªìi t·ª´ server: ${data.message}</div>`;
        });

        socket.on('connect_error', (err) => {
          statusDiv.textContent = '‚ö†Ô∏è L·ªói k·∫øt n·ªëi!';
          statusDiv.style.background = '#ffeaea';
          logDiv.innerHTML += `<div class="error">L·ªói: ${err.message}</div>`;
          console.error('Connection error:', err);
        });

        document.getElementById('sendBtn').addEventListener('click', () => {
          const message = document.getElementById('messageInput').value.trim();
          if (!message) {
            alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p n·ªôi dung tr∆∞·ªõc khi g·ª≠i!');
            return;
          }
          if (!socket || !socket.connected) {
            alert('‚ö†Ô∏è B·∫°n ch∆∞a k·∫øt n·ªëi WebSocket!');
            return;
          }

          socket.emit('test message', message);
          logDiv.innerHTML += `<div class="message">üì§ ƒê√£ g·ª≠i message: "${message}"</div>`;
        });
      });
    </script>
  </body>
</html>
